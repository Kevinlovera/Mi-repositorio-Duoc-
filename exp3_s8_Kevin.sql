-- =============================
-- 1. ELIMINAR TABLAS SI EXISTEN
-- =============================
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE DETALLE_VENTA CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE VENTA CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE EMPLEADO CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE SALUD CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE AFP CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE MEDIO_PAGO CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE PRODUCTO CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE MARCA CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE CATEGORIA CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE PROVEEDOR CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE COMUNA CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN
   EXECUTE IMMEDIATE 'DROP TABLE REGION CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL; END;
/

-- =============================
-- 2. CREAR TABLAS
-- =============================

CREATE TABLE REGION (
    ID_REGION NUMBER PRIMARY KEY,
    NOMBRE_REGION VARCHAR2(100) NOT NULL
);

CREATE TABLE COMUNA (
    ID_COMUNA NUMBER PRIMARY KEY,
    NOMBRE_COMUNA VARCHAR2(100) NOT NULL,
    ID_REGION NUMBER,
    CONSTRAINT FK_COMUNA_REGION FOREIGN KEY (ID_REGION)
        REFERENCES REGION(ID_REGION)
);

CREATE TABLE PROVEEDOR (
    ID_PROVEEDOR NUMBER PRIMARY KEY,
    NOMBRE_PROVEEDOR VARCHAR2(100) NOT NULL,
    TELEFONO VARCHAR2(20)
);

CREATE TABLE CATEGORIA (
    ID_CATEGORIA NUMBER PRIMARY KEY,
    NOMBRE_CATEGORIA VARCHAR2(100) NOT NULL
);

CREATE TABLE MARCA (
    ID_MARCA NUMBER PRIMARY KEY,
    NOMBRE_MARCA VARCHAR2(100) NOT NULL
);

CREATE TABLE PRODUCTO (
    ID_PRODUCTO NUMBER PRIMARY KEY,
    NOMBRE_PRODUCTO VARCHAR2(100) NOT NULL,
    PRECIO NUMBER NOT NULL,
    ID_MARCA NUMBER,
    ID_CATEGORIA NUMBER,
    ID_PROVEEDOR NUMBER,
    CONSTRAINT FK_PRODUCTO_MARCA FOREIGN KEY (ID_MARCA) REFERENCES MARCA(ID_MARCA),
    CONSTRAINT FK_PRODUCTO_CATEGORIA FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIA(ID_CATEGORIA),
    CONSTRAINT FK_PRODUCTO_PROVEEDOR FOREIGN KEY (ID_PROVEEDOR) REFERENCES PROVEEDOR(ID_PROVEEDOR)
);

CREATE TABLE MEDIO_PAGO (
    ID_MEDIO_PAGO NUMBER PRIMARY KEY,
    NOMBRE_MEDIO VARCHAR2(50) NOT NULL
);

CREATE TABLE AFP (
    ID_AFP NUMBER PRIMARY KEY,
    NOMBRE_AFP VARCHAR2(100) NOT NULL
);

CREATE TABLE SALUD (
    ID_SALUD NUMBER PRIMARY KEY,
    NOMBRE_SALUD VARCHAR2(100) NOT NULL
);

CREATE TABLE EMPLEADO (
    ID_EMPLEADO NUMBER PRIMARY KEY,
    NOMBRE_EMPLEADO VARCHAR2(100) NOT NULL,
    APELLIDO_EMPLEADO VARCHAR2(100) NOT NULL,
    ID_AFP NUMBER,
    ID_SALUD NUMBER,
    CONSTRAINT FK_EMPLEADO_AFP FOREIGN KEY (ID_AFP) REFERENCES AFP(ID_AFP),
    CONSTRAINT FK_EMPLEADO_SALUD FOREIGN KEY (ID_SALUD) REFERENCES SALUD(ID_SALUD)
);

CREATE TABLE VENTA (
    ID_VENTA NUMBER PRIMARY KEY,
    FECHA_VENTA DATE DEFAULT SYSDATE,
    ID_MEDIO_PAGO NUMBER,
    ID_EMPLEADO NUMBER,
    CONSTRAINT FK_VENTA_MEDIO FOREIGN KEY (ID_MEDIO_PAGO) REFERENCES MEDIO_PAGO(ID_MEDIO_PAGO),
    CONSTRAINT FK_VENTA_EMPLEADO FOREIGN KEY (ID_EMPLEADO) REFERENCES EMPLEADO(ID_EMPLEADO)
);

CREATE TABLE DETALLE_VENTA (
    ID_DETALLE NUMBER PRIMARY KEY,
    ID_VENTA NUMBER,
    ID_PRODUCTO NUMBER,
    CANTIDAD NUMBER NOT NULL,
    PRECIO_UNITARIO NUMBER NOT NULL,
    CONSTRAINT FK_DETALLE_VENTA FOREIGN KEY (ID_VENTA) REFERENCES VENTA(ID_VENTA),
    CONSTRAINT FK_DETALLE_PRODUCTO FOREIGN KEY (ID_PRODUCTO) REFERENCES PRODUCTO(ID_PRODUCTO)
);

-- =============================
-- 3. INSERTAR DATOS DE EJEMPLO
-- =============================

-- REGION
INSERT INTO REGION VALUES (1, 'Metropolitana');
INSERT INTO REGION VALUES (2, 'Valparaiso');

-- COMUNA
INSERT INTO COMUNA VALUES (1, 'Santiago', 1);
INSERT INTO COMUNA VALUES (2, 'Providencia', 1);
INSERT INTO COMUNA VALUES (3, 'Vi√±a del Mar', 2);

-- PROVEEDOR
INSERT INTO PROVEEDOR VALUES (1, 'Proveedor A', '123456789');
INSERT INTO PROVEEDOR VALUES (2, 'Proveedor B', '987654321');

-- CATEGORIA
INSERT INTO CATEGORIA VALUES (1, 'Bebidas');
INSERT INTO CATEGORIA VALUES (2, 'Alimentos');

-- MARCA
INSERT INTO MARCA VALUES (1, 'Marca A');
INSERT INTO MARCA VALUES (2, 'Marca B');

-- PRODUCTO
INSERT INTO PRODUCTO VALUES (1, 'Producto 1', 1000, 1, 1, 1);
INSERT INTO PRODUCTO VALUES (2, 'Producto 2', 2000, 2, 2, 2);

-- MEDIO_PAGO
INSERT INTO MEDIO_PAGO VALUES (1, 'Efectivo');
INSERT INTO MEDIO_PAGO VALUES (2, 'Tarjeta');

-- AFP
INSERT INTO AFP VALUES (1, 'AFP Capital');
INSERT INTO AFP VALUES (2, 'AFP Habitat');

-- SALUD
INSERT INTO SALUD VALUES (1, 'FONASA');
INSERT INTO SALUD VALUES (2, 'ISAPRE');

-- EMPLEADO
INSERT INTO EMPLEADO VALUES (1, 'Juan', 'Perez', 1, 1);
INSERT INTO EMPLEADO VALUES (2, 'Maria', 'Lopez', 2, 2);

-- VENTA
INSERT INTO VENTA VALUES (1, SYSDATE, 1, 1);

-- DETALLE_VENTA
INSERT INTO DETALLE_VENTA VALUES (1, 1, 1, 3, 1000);
INSERT INTO DETALLE_VENTA VALUES (2, 1, 2, 2, 2000);


COMMIT;


